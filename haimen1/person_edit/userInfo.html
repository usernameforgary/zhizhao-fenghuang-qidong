<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=0">
    <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=EDGE">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="iconfont.css" />
    <link rel="stylesheet" href="common.css"/>
    <link rel="stylesheet" href="userInfo.css" />
	<link rel="stylesheet" type="text/css" href="mobileSelect.css"/>
	<link rel="stylesheet" href="./demo/style.css?v=2">
	<link rel="stylesheet" type="text/css" href="../css/commonUI.css"/>
	<link rel="stylesheet" type="text/css" href="../css/style.css"/>
<link rel="stylesheet" href="./demo/comm.css">
    <script type="text/javascript" src="resize.js"></script>
    <script type="text/javascript" src="jquery-1.9.1.min.js"></script>
    <script src="mobileSelect.min.js" type="text/javascript" charset="utf-8"></script>

<script src="./demo/sonic.js"></script>
<script src="./demo/comm.js"></script>
<script src="./demo/hammer.js"></script>
<script src="./demo/iscroll-zoom.js"></script>
<script src="./demo/jquery.photoClip.js?v=1"></script>
    <title>修改头像</title>
</head>
<body>
	<div class="wrapMax">
		<div class="contentWrap">
			<ul class="content-body">
	    <li class="imgContent">
	        <div class="key">头像</div>
	        <div class="value"><img src="room_05.png"  id="user_logo" /></div>
	        <div class="icon iconfont icon-iconfontyoujiantou"></div>
	    </li>
	    <li class="name">
	        <div class="key">昵称</div>
	        <div class="value"><span id="user_name">事实上</span></div>
	        <div class="icon iconfont icon-iconfontyoujiantou"></div>
	    </li>
	    <li class="yaoqingma">
	        <div class="key">我的邀请码</div>
	        <div class="value"><span id="yaoqingma">5TNS73</span></div>
	    </li>
	    <li class="gender">
	        <div class="key">性别</div>
	        <div class="value"><span id="user_gender">男</span></div>
	        <div class="icon iconfont icon-iconfontyoujiantou"></div>
	    </li>
	    <!--<li class="birthday">
	        <div class="key">出生日期</div>
	        <div class="value"><span id="user_birthday"></span></div>
	        <div class="icon iconfont icon-iconfontyoujiantou"></div>
	    </li> -->
	    <li class="school">
	        <div class="key">学校</div>
	        <div class="value"><span id="user_phone">吕四重点中学</span></div>
	        <div class="icon iconfont icon-iconfontyoujiantou"></div>
	    </li>
	    <li class="training">
	        <div class="key">培训机构</div>
	        <div class="value"><span id="user_email">无</span></div>
	        <div class="icon iconfont icon-iconfontyoujiantou"></div>
	    </li>
	    <!--<li class="adress">
	        <div class="key">我的地址</div>
	        <div class="value"><span id="user_adress">无</span></div>
	        <div class="icon iconfont icon-iconfontyoujiantou"></div>
	    </li>-->
	    <li class="signature">
	        <div class="key">我的签名</div>
	        <div class="value"><span id="signature">未填写</span></div>
	        <div class="icon iconfont icon-iconfontyoujiantou"></div>
	    </li>
	     <li class="course">
	        <div class="key" style="position: absolute;left: 0;">我的课程授权</div>
	        <div class="value" style="float: right;"><span id="course">点我添加</span><i class="icon iconfont icon-iconfontyoujiantou" style="float: right;"></i></div>
	        
	    </li>
	</ul>
	<div class="content-side" style="display: none;margin-top: -0.32rem;padding-top: 0.3rem;">
		<div class="changeImg">
			<!--<input id="xdaTanFileImg" type="file" name="img" accept="image/*" style="display: none;" onchange="xmTanUploadImg(this)">
			 <div class="img-box" id="imgboxid">  
	  
			</div>  
			<button>保存</button>-->
			<!--////////////////////////////////////////////-->
			<!--加载资源-->
	<div class="lazy_tip" id="lazy_tip" style="text-align: center;">
		<span>1%</span><br>
		加载是很重要的......
	</div>
	<div class="lazy_cover"></div>
	<div class="resource_lazy hide"></div>
	
	<div class="pic_edit">
		<!--<h2 style="color: #FFFFFF">图片编辑(双指旋转和双指缩放)</h2>-->
	
		<div id="clipArea"></div>
		<div class="buttonClip">
			<button id="upload2">选择图片</button>
		<input type="file" accept="image/*"  id="file" >
	    <button id="clipBtn">上传图片</button>
		</div>
		
		
		
	</div>
	<img src="" title="upload.jpg" fileName="" id="hit" style="display:none;z-index: 9">
	<!--////////////////////////////////////////////-->
		</div>
		<div class="changeName"><!--//昵称-->
			<input type="text" name="name" id="name" value=""   placeholder="填写您的昵称"/>
			<button class="return">保存</button>
		</div>
		<div class="changeTel"><!--地址-->
			<input type="text" name="tel" id="tel" value="" />
			<button class="return">保存</button>
		</div>
		<div class="changeMail"><!--签名-->
			<input type="email" name="mail" id="mail" value="" placeholder="填写您的签名"/>
			<button class="return">保存</button>
		</div>
		<div class="kechengma"><!--签名-->
			<input type="text" name="kechengma" id="kechengma" value="" placeholder="填写您的课程授权码"/>
			<button class="return">保存</button>
		</div>
	</div>
		</div>
	<div id="cover"></div>
	</div>
		<!--选择地区弹层-->
        <section id="areaLayer" class="express-area-box">
            <header>
                <h3>选择地区</h3>
                <a id="backUp" class="back" href="javascript:void(0)" title="返回"></a>
                <a id="closeArea" class="close" href="javascript:void(0)" title="关闭"></a>
            </header>
            <article id="areaBox">
                <ul id="areaList" class="area-list"></ul>
            </article>
        </section>
        <!--遮罩层-->
        <div id="areaMask" class="mask"></div>	
</body>
<script src="../js/commonUI.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/utils.js" type="text/javascript" charset="utf-8"></script>
<!--<script src="../js/jquery.area.js" type="text/javascript" charset="utf-8"></script>-->
<script>
	
	

    function goUrl(url){
        location.href=url;
    }
     $(".imgContent").click(function(){
     	$(".content-side").css("display","block");
//   	window.history.pushState('forward', null, '#forward'); 
//  	document.getElementById("xdaTanFileImg").click();
//$('#file').click();
    	$(".changeImg").css("display","block");
    	$('.pic_edit').show();
    	
    	$('#clipArea img').attr("src","");
		$(".contentWrap").animate({
			left:"-7.5rem"
		},500)
	})
//   function gg(){
////			console.log(111);
////			$('#xdaTanFileImg').get(0).click();
//			document.getElementById("xdaTanFileImg").click();
//		}
    $(".name").click(function(){
    	$(".content-side").css("display","block");
    	window.history.pushState('forward', null, '#forward');
    	$(".changeName").css("display","block");
    	
		$(".contentWrap").animate({
			left:"-7.5rem"
		},500,function(){
			$(".changeName input").focus();
		})
	})
    $(".adress").click(function(){/*地址*/
    	$(".content-side").css("display","block");
    	window.history.pushState('forward', null, '#forward'); 
    	$(".changeTel").css("display","block");
		$(".contentWrap").animate({
			left:"-7.5rem"
		},500,function(){
			$(".changeTel input").focus();
		})
	})
    $(".signature").click(function(){
    	$(".content-side").css("display","block");
    	window.history.pushState('forward', null, '#forward'); 
    	$(".changeMail").css("display","block");
		$(".contentWrap").animate({
			left:"-7.5rem"
		},500,function(){
			$(".changeMail input").focus();
		})
		
	})
	 $(".course").click(function(){
    	$(".content-side").css("display","block");
    	window.history.pushState('forward', null, '#forward'); 
    	$(".kechengma").css("display","block");
		$(".contentWrap").animate({
			left:"-7.5rem"
		},500,function(){
			$(".kechengma input").focus();
		})
		
	})
//  $(".signature").click(function(){
//  	$(".content-side").css("display","block");
//  	window.history.pushState('forward', null, '#forward'); 
//  	$(".changeMail").css("display","block");
//		$(".contentWrap").animate({
//			left:"-7.5rem"
//		},500,function(){
//			$(".changeMail input").focus();
//		})
//		
//	})
     $(".return").click(function(){
     	if ($(this).prev().val()=="") {
     		alert("字符不能为空！");
     		return false;
     	}
     	
     	if ($(this).prev().attr("id")=="name") {
     		$("#user_name").text($(this).prev().val());
     		
     		$.post(hostAjax+"/api/user/v1/modifyinfo", {user_id:uid,token:localStorage.getItem("zhizhao_token"),nickname: $(this).prev().val()}, function (data) {
				if (data.Code==0) {
					ui.showToast( '昵称设置成功');
				}else{
					ui.showToast(data.Msg);
				}
			});
     	} else if ($(this).prev().attr("id")=="tel"){
     		$("#user_adress").text($(this).prev().val());
     	}else if ($(this).prev().attr("id")=="mail"){
     		//调取修改签名接口
     		$.get(hostAjax+"/api/user/v1/updateautograph", {userid:uid,autograph: $(this).prev().val()}, function (data) {
				if (data.Code==0) {
					ui.showToast( '签名成功');
				}else{
					ui.showToast(data.Msg);
				}
			});
     		 $("#signature").text($(this).prev().val());
     		 $(".signature span").css("line-height","1.2rem");
			if($(".signature")[0].offsetHeight>$(".yaoqingma")[0].offsetHeight){
				
				$(".signature span").css("line-height","0.5rem");
				$(".signature span").css("text-align","left");
			}
     	}else  if ($(this).prev().attr("id")=="kechengma"){
     		//授权课程
//   		ui.showToast('需要课程ID',3000);
     		
     		$.get(hostAjax+"/api/course/v1/addauthorization", {userid:uid,code: $(this).prev().val()}, function (data) {
				if (data.Code==0) {
					ui.showToast( '绑定成功');
				}else{
					ui.showToast(data.Msg);
				}
			});
     	}
     	$(this).prev().val("");
     	$(".content-side").css("display","none");
    	$(".changeName").css("display","none");
    	$(".changeTel").css("display","none");
    	$(".changeMail").css("display","none");
    	history.back();
    	$(".changeName input").attr("autofocus",false);
		$(".contentWrap").animate({
			left:"0rem"
		},500)
	})
//性别选择
$(".imgContent").click();
var mobileSelect1 = new MobileSelect({
    trigger: '#user_gender', 
    title: '选择性别',  
    wheels: [
                {data: ["男","女"]}
            ],
    position:[], //初始化定位 打开时默认选中的哪个 如果不填默认为0
    transitionEnd:function(indexArr, data){
        console.log(data);
    },
    callback:function(indexArr, data){
        console.log(data);
    }
});
$(".gender").click(function(){
	mobileSelect1.show();
})
</script>

<script type="text/javascript">  
    //选择图片，马上预览  
    function xmTanUploadImg(obj) {   
        var fl=obj.files.length;  
        for(var i=0;i<fl;i++){  
            var file=obj.files[i];  
            var reader = new FileReader();  
  
            //读取文件过程方法  
  
            reader.onloadstart = function (e) {  
                console.log("开始读取....");  
            }  
            reader.onprogress = function (e) {  
                console.log("正在读取中....");  
            }  
            reader.onabort = function (e) {  
                console.log("中断读取....");  
            }  
            reader.onerror = function (e) {  
                console.log("读取异常....");  
            }  
            reader.onload = function (e) {  
                console.log("成功读取....");  
  
                var imgstr='<img style="width:100px;height:100px;" src="'+e.target.result+'"/>';  
                var oimgbox=document.getElementById("imgboxid");  
                
                oimgbox.innerHTML=imgstr;  
                alert(imgstr);  
                oimgbox.className="img-div";  
//              oimgbox.appendChild(ndiv);  
                 
            }  
  
            reader.readAsDataURL(file);  
//alert(1);  
        }  
  
    }  
</script>  
<script>
var hammer = '';
var currentIndex = 0;
var body_width = $('body').width();
var body_height = $('body').height();

$("#clipArea").photoClip({
	width: body_width * 0.8125,
	height: body_width * 0.8125,
	file: "#file",
	view: "#hit",
	ok: "#clipBtn",
	loadStart: function () {
		//console.log("照片读取中");
		$('.lazy_tip span').text('');
		$('.lazy_cover,.lazy_tip,.pic_edit').show();
	},
	loadComplete: function () {
		//console.log("照片读取完成");
		$('.lazy_cover,.lazy_tip').hide();
	},
	clipFinish: function (dataURL) {
		$('#hit').attr('src', dataURL);
		saveImageInfo();
	}
});

//图片上传
function saveImageInfo() {
	var filename = $('#hit').attr('fileName');
	var img_data = $('#hit').attr('src');
//		$(".changeName").css("display","none");
//  	$(".changeTel").css("display","none");
//  	$(".changeMail").css("display","none");
//  	$('.lazy_cover,.lazy_tip,.pic_edit').hide();
//  	$(".imgContent img").attr("src",img_data);
//		$(".content-side").css("display","none");
//		imgLoaded=false;
		$.post(hostAjax+"/api/other/v1/base64upload", {base64: img_data}, function (data) {
			console.log(data.Data.imgurl);
			$.post(hostAjax+"/api/user/v1/modifyphoto", {user_id:uid,iType:localStorage.getItem("zhizhao_typle"),token:localStorage.getItem("zhizhao_token"),imgurl: data.Data.imgurl}, function (data) {
				if (data.Code==0) {
					sessionStorage.setItem("ifReload",1);
					ui.showToast( '头像设置成功');
					history.back();
				}else{
					ui.showToast(data.Msg);
				}
			});
			
	});
		
}

/*获取文件拓展名*/
function getFileExt(str) {
	var d = /\.[^\.]+$/.exec(str);
	return d;
}

//图片上传结束
$(function () {
	$('#upload2').on('touchstart', function () {
		//图片上传按钮
		$('#file').click();
	})
})

//、、点击返回键
if (window.history && window.history.pushState) 
{ 
	$(window).on('popstate', function() { 
		var hashLocation = location.hash;
		var hashSplit = hashLocation.split("#!/");
 		var hashName = hashSplit[1]; 
 if (hashName !== '') { var hash = window.location.hash; if (hash === '') { 
 			$(".changeName").css("display","none");
    	$(".changeTel").css("display","none");
    	$(".changeMail").css("display","none");
    	$(".kechengma").css("display","none");
    	$('.lazy_cover,.lazy_tip,.pic_edit').hide();
		$(".contentWrap").animate({
			left:"0rem"
		},500)
 } } });
// window.history.pushState('forward', null, './#forward'); 
}
</script>
</html>