<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
   	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=0">
    <title>课程表详情</title>
    <link rel="stylesheet" type="text/css" href="../../css/common.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/swiper-3.4.2.min.css"/>
    <link rel="stylesheet" type="text/css" href="../../iconfont/iconfont.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/commonUI.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/animate.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/index.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/index1.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/webuploader/webuploader.css"/>
    <script src="../../js/resize.js" type="text/javascript" charset="utf-8"></script>
    <style type="text/css">
    	.my_course header,.my_children header,.ditui header{
    		margin-top: 0.2rem;
    		margin-bottom: 0.15rem;
    		font-size: 0.28rem;
    		font-weight: 900;
    	}
    	.ditui li{
    		height: 0.9rem;
    		line-height: 0.9rem;
    		border-bottom: 1px solid #eee;
    	}
    	.ditui li i{
    		float: right;
    		font-size: 0.3rem;
    	}
    	.my_course i{
    		float: right;
    		font-weight: 100;
    	}
    	.my_course img{
    		width: 4rem;
    		display: block;
    		margin: auto;
    	}
    	.my_course li{
    		margin-top: 0.2rem;
    	}
    	.my_children{
    		margin-bottom: 0.5rem;
    	}
    	.my_children ul ul{
    		clear: both;
    		position: relative;
    		right: 0.5rem;
    		width: 7.5rem;
    		border-bottom: 1px solid #eee;
    	}
    	.my_children ul ul li{
    		text-align: center;
    		float: left;
    		width: 33.33%;
    		padding-bottom: 0.15rem;
    		padding-top: 0.2rem;
    		
    	}
    	.my_children img{
    		width: 0.61rem;
    		height: 0.61rem;
    		border-radius: 0.61rem;
    		
    	}
    	.my_children button{
    		margin-bottom: 0.15rem;
    		width: 1.6rem;
    		height: 0.55rem;
    		border-radius: 0.55rem;
    		background-color: #FBD15B;
    		border: 0;
    	}
    	.pre img{
    		width: 0.4rem;
    		position: absolute;
    		top: 0.45rem;
    		left: 0.2rem;
    		z-index: 222;
    	}
    	.pre,.next{
    		display: none;
    	}
    	.next img{
    		z-index: 222;
    		width: 0.4rem;
    		position: absolute;
    		top: 0.45rem;
    		right: 0.2rem!important;
    	}
    	.hadregister{
    		background-color: #FDE8AD!important;
    	}
    	.noregister{
    		background-color: #EAEAEA!important;
    	}
    	.t_card .more{
    		display: block;
		    position: absolute;
		    width: 0.55rem;
		    right: 0.2rem;
		    bottom: 0.2rem;
    	}
    	.teacher .tab{
			padding: 0 1.2rem;
		}
		.teacher .tab li{
			width: 33.33%;
		}
		.circle_out{
			width: 5.5rem;
			height: 4.5rem;
			margin: auto;
			border-left: 0.277rem solid #809292;
			border-bottom: 0.277rem solid #809292;
			position: relative;
		}
		.circle1{
			position: absolute;
			height: 80%;
			width: 1.34rem;
			background-color: red;
			left: 0.47rem;
			bottom: 0;
		}
		.circle2{
			position: absolute;
			height: 60%;
			width: 1.34rem;
			background-color: #EFB511;
			left: 2.8rem;
			bottom: 0;
		}
		.t{
			position: absolute;
			top: -0.4rem;
			width: 100%;
			text-align: center;
			color: red;
		}
		.b{
			width: 1.9rem;
			left: -0.2rem;
			position: absolute;
			bottom: -0.8rem;
		}
		.content{
			padding-left: 1.5rem;
			margin-top: 0.2rem;
		}
    </style>
</head>
<body class="up-page">
	<div class="t_card animated card1 zoomIn" style="display: none;">
		<div class="name"><p style="font-size: 0.5rem;"></p> <img src="../../img/bodyBg/defined.jpg" alt="" /></div>
		<div class="tName" style="margin-left: 0.6rem;"></div>
		<div class="tel"></div>
		<img class="more" onclick="goUrl('changeCard.html?type=1')" src="../../img/moreCards.png"/>
	</div>
	<div class="up-page-wrapper teacher">
		<div class="header">
			<div class="clearfix"></div>
			
		</div>
		<div class="clearfix"></div>
		<div class="main">
			<div class="main_t">
				<div class="my_course">
					<header> <!--onclick="goUrl('src/Course/example.html')"-->本节课程介绍<!--<i class="iconfont icon-you"></i><i style="position: relative;left: 0.15rem;" class="iconfont icon-you"></i>--></header>
					<ul>
						<li>课程类型：<span style="color: #EFB511;"></span></li>
						<li class="">上课时间：<span></span></li>
						<li class="">所在班级：<span></span></li>
						<!--<li class="">课程主题：<span></span></li>-->
						
					</ul>
				</div>
				<div class="my_children">
					<header>班级成员</header>
					<ul>
						
					</ul>
					<div class="clearfix"></div>
				</div>
			</div>
		</div>
		<div class="float"></div>
		<div class="class_show"  style="left: -7.5rem;">
			<div class="text">
				<textarea style="resize: none;height: 1.9rem;text-align: left;text-indent: 2em;border: 1px solid #eee;padding: 0.15rem;line-height: 0.45rem;box-sizing: border-box;" id="text" name="show" rows="" cols="">
					
				</textarea>
				<div class="button submit">
					提交
				</div>
				<div class="swiper-container">
				  <div class="swiper-wrapper">
				  	<div class="swiper-slide" id="modelImg"><img src="../../img/addImg.png"/></div>
				    <!--<div class="swiper-slide">slider1</div>
				    <div class="swiper-slide">slider2</div>
				    <div class="swiper-slide">slider3</div>-->
				  </div>
				  <div class="pre">
				  	<img src="../../img/left@3x.png"/>
				  </div>
				  <div class="next">
				  	<img src="../../img/right@3x.png"/>
				  </div>
				</div>
			</div>
		</div>
	</div>
</body>
<script src="../../js/jquery-1.7.2.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/swiper-3.4.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/commonUI.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/utils.js" type="text/javascript" charset="utf-8"></script>
<script src="../../css/webuploader/webuploader.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
//	AJAX
	var curriculumid,studentId,classImgLists="";//课程ID/学生id
//、、、、、、、、、、、、、、、、、、、、、、、、、、、、、、、、、、、、、、、、、、、、、、
var mySwiper = new Swiper('.swiper-container', {
	autoplay: 5000,//可选选项，自动滑动
	slidesPerView: 3,
	spaceBetween: 10
})
var BASE_URL= window.location.pathname;
var uploader;
uploaderInit();
function uploaderInit(){
	

uploader= WebUploader.create({

    // 选完文件后，是否自动上传。
    auto: true,

    // swf文件路径
    swf: BASE_URL + '/css/webuploader/Uploader.swf',

    // 文件接收服务端。
    server: hostAjax+'/api/other/v1/PostFile',

    // 选择文件的按钮。可选。
    // 内部根据当前运行是创建，可能是input元素，也可能是flash.
    pick: {
    	id:'#modelImg',
    	multiple:true
    	
    }
    ,

    // 只允许选择图片文件。
    accept: {
        title: 'Images',
        extensions: '*',
        mimeTypes: 'image/*'
    }
});
 /* 上传前判断 */
    uploader.on('beforeFileQueued', function (file) {
    	
      progress = 0;
      /* 图片 */
      if ('gif,jpg,jpeg,bmp,png'.indexOf(file.ext.toLowerCase()) == -1) {
       alert('请上传图片文件');
        return false;
      }else{
      	/* makeThumb方法生成缩略图获取图片base64 */
        uploader.makeThumb(file, function(error, src){
          if (error) {
            alert('图片错误');
            return;
          }
//        this.$refs.cropImg.changeImg(src, this.width, this.height, this.dataId);
        }, 1, 1); /* 缩略图尺寸，大于1为px，0-1之间为百分比 */
      }
      /* 视频 */
      if (this.type == 'video') {
        if ('mp4,webm,m3u8,ogg'.indexOf(file.ext.toLowerCase()) == -1) {
         alert('请上传支持的视频文件');
          return false;
        }
      }
      if (file.size > (3 * 1e8)) {
       alert('文件大小不可超过300M');
        return false;
      }
      /* 裁剪 */
//    if (this.crop) {
//      /* makeThumb方法生成缩略图获取图片base64 */
//      this.uploader.makeThumb(file, (error, src) => {
//        if (error) {
//          this.$message('图片错误');
//          return;
//        }
//        this.$refs.cropImg.changeImg(src, this.width, this.height, this.dataId);
//      }, 1, 1); /* 缩略图尺寸，大于1为px，0-1之间为百分比 */
//      return false;
//    }
//    this.loading = true;
	  
      return true;

    })
// 当有文件添加进来的时候
uploader.on( 'uploadSuccess', function( file ,response) {
		if(classImgLists.split("|").length>9){//超过之后的判断
			uploader.stop();
			ui.showToast("限制9张,已满！");
			return false;
		}
		try{
			classImgLists+=response.Data[0].f_url+"|";console.log(classImgLists);
		}catch(e){
			//TODO handle the exception
		}

if(classImgLists.split("|").length>3){
	$(".pre").show();
	$(".next").show();
}
if(classImgLists.split("|").length>9){
	$('#modelImg').hide();
}
var $li;
try{
			$li= $(
            '<div class="swiper-slide file-item thumbnail"  ontouchstart="gtouchstart(this)" ontouchmove="gtouchmove(this)" ontouchend="gtouchend(this)" style="background-image: url('+response.Data[0].f_url+');">' +
//              '<img  src="'+response.Data[0].f_url+'"/>' +
            '</div>'
            ),
        $img = $li.find('img');
		}catch(e){
			//TODO handle the exception
		}
		
    // $list为容器jQuery实例
    $('.swiper-wrapper').append( $li );
    mySwiper.update();
});
// 文件上传过程中创建进度条实时显示。
uploader.on( 'uploadProgress', function( file, percentage ) {
	
    var $li = $( '#'+file.id ),
        $percent = $li.find('.progress span');
    // 避免重复创建
    if ( !$percent.length ) {
        $percent = $('<p class="progress"><span></span></p>')
                .appendTo( $li )
                .find('span');
    }

    $percent.css( 'width', percentage * 100 + '%' );
    progress=parseInt(percentage* 100);
});

}
//////////////////////////////////////////////------------------------------------
var timeOutEvent=0;//定时器   
//开始按   
function gtouchstart(_this){  
    timeOutEvent = setTimeout(function(){
    	longPress(_this);
    },1000);//这里设置定时器，定义长按500毫秒触发长按事件，时间可以自己改，个人感觉500毫秒非常合适
    return false;   
};   
//手释放，如果在500毫秒内就释放，则取消长按事件，此时可以执行onclick应该执行的事件   
function gtouchend(_this){   
    clearTimeout(timeOutEvent);//清除定时器   
    if(timeOutEvent!=0){   
        //这里写要执行的内容（尤如onclick事件）   
    }   
    return false;   
};   
//如果手指有移动，则取消所有事件，此时说明用户只是要移动而不是长按   
function gtouchmove(_this){   
    clearTimeout(timeOutEvent);//清除定时器   
    timeOutEvent = 0;   
      
};   
   
//真正长按后应该执行的内容   
var splitStr="",re;
function longPress(_this){   
    timeOutEvent = 0;   
   splitStr=$(_this).css("background-image").split('url("')[1].split('")')[0]+"|";
    console.log(splitStr)
    //执行长按要执行的内容，如弹出菜单   
   ui.showAlert('是否确认删除该图片', function () {//确认
               $(_this).remove();
                re =new RegExp(splitStr,"gim");
                classImgLists.replace(re,"");
                
                console.log(classImgLists)
            },function(){//不是默认地址
            	
            	return false;
            },"确定","取消","提示");
}
		function clearFloat(){
			$('.float').hide();
			$('.class_show').hide();
			classImgLists="";
			$("textarea").val("");
			$(".swiper-wrapper").html('<div class="swiper-slide" id="modelImg"><img src="../../img/addImg.png"/></div>');
			 mySwiper.update();
			 console.log(classImgLists.split('|').length)
			 uploaderInit();
		}
		getAjax(hostAjax+"/api/tch/v1/getclasscourseinfo",{
			curriculumid:location.href.split("?id=")[1].split("&")[0]
		},function(data){
			if(data.Data.classcourse==undefined){
					$(".my_course ul").html('<img src="img/noCource.png"/>');
					$(".my_children").hide();
				}else{
					$(".my_course ul li").eq(0).find("span").text(data.Data.classcourse.subjecttype);
					$(".my_course ul li").eq(1).find("span").text(data.Data.classcourse.classtime);
					$(".my_course ul li").eq(2).find("span").text(data.Data.classcourse.classname);
					$(".my_course ul li").eq(3).find("span").text(data.Data.classcourse.subjectname);
					curriculumid=data.Data.classcourse.id;//记录本节课的课程id
					var str="",registerStr="",registerClass="",jilustr="";
					for(var i=0;i<data.Data.studentlist.length;i++){
						if(data.Data.studentlist[i].qdstate==1){//签到
							registerStr="hadregister"; 
							registerClass="已签到";
						}else if(data.Data.studentlist[i].qdstate==2){
							registerStr="noregister";
							registerClass="未签到";
						}else{
							registerStr="";
							registerClass="签到";
						}
						if(data.Data.studentlist[i].typeclasshour<=0){
							data.Data.studentlist[i].typeclasshour=0;
						}
						if(data.Data.studentlist[i].typeclasshour<=8){
							color= 'style="color:red;margin:0 0.1rem;font-size:0.3rem"';
						}else{
							color="";
						}
						if(data.Data.studentlist[i].qdstate=="1"){
							jilustr="已表扬";
						}else{
							jilustr="添加表现";
						}
						str+='<li>'+
							'<ul class="ul" id="'+data.Data.studentlist[i].id+'">'+
								'<li><img src="../../img/default_person.png" alt="" /><p>'+data.Data.studentlist[i].NAME+'</p></li>'+
								'<li style="padding-bottom:0;"><button class="edit_button">查看表现</button><button class="register">'+jilustr+'</button></li>'+
								'<li><p style="margin-top:0.1rem;">剩余课时：<span '+color+'>'+data.Data.studentlist[i].typeclasshour<=0?0:data.Data.studentlist[i].typeclasshour+'</span></p></li>'+
							'<div class="clearfix"></div>'+
							'</ul>'+
						'</li>';
					}
					$(".my_children ul").html(str);
					if((new Date()-new Date(data.Data.classcourse.classtime.split("-")[0].replace(/日/,"").replace(/年/,"-").replace(/月/,"-"))>0)){
						$(".edit_button").click(function(){
							//记录学生id
							studentId=$(this).parents('.ul').attr('id');
							location.href="../../studyhistry.html?studentId="+studentId+"&curriculumid="+location.href.split("?id=")[1].split("&")[0];
						})
						$(".register").click(function(){//签到
							studentId=$(this).parents('.ul').attr('id');
							$('.float').show();
							$('.class_show').css("left","0.6rem");
							$('.class_show').show();
						})
					}
				}
		})
		$(".submit").click(function(){//
			
			getAjax(hostAjax+"/api/tch/v1/addclassroomperformance",{//添加学生的课堂表现
				user_id:studentId,
				curriculumid:curriculumid,
				teacherid:uid,
				principalsevaluation:$('textarea').val(),
				imglist:classImgLists.substring(0,classImgLists.length - 1)
			},function(data){
				if(data.Code==200){
					ui.showToast( '提交成功');
					clearFloat();
					$("#"+studentId).find(".register").text("已表扬");
				}
			})
		})
		$(".next").click(function(){
	mySwiper.slideNext();
})
$(".pre").click(function(){
	mySwiper.slidePrev();
})

$('.float').click(function(){
	
	
	clearFloat();
	
	 
})
</script>
</html>