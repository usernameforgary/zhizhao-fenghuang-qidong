<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
   	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=0">
    <title>历史记录</title>
    <link rel="stylesheet" type="text/css" href="../../css/common.css"/>
    <link rel="stylesheet" type="text/css" href="../../iconfont/iconfont.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/commonUI.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/index.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/index1.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/mobileSelect.css"/>
    <script src="../../js/resize.js" type="text/javascript" charset="utf-8"></script>
    <style type="text/css">
    	body{
    		background-color: #fff;
    		background-image: url(../../img/bodyBg/ditui@3x.jpg);
    		background-size: 100%;
    		background-repeat: no-repeat;
    		background-position: bottom;
    		padding-bottom: 0.5rem;
    	}
    	.content{
    		padding-bottom: 0.5rem;
    	}
    	.name1{
    		display: inline;
    	}
    	.main,.othermain{
    		font-size: 0.26rem;
    	}
    	.main>ul>li,.othermain>ul>li{
    		line-height: 0.86rem;
    		border-bottom: 1px solid #eee;
    		padding: 0 0.5rem;
    		margin-top: 0.01rem;
    	}
    	.main ul li span,.othermain ul li span{
    		position: absolute;
    		right: 0.5rem;
    		box-sizing: border-box;
    	}
    	.main li i,.othermain li i{
    		display: inline-block;
    		font-size: .26rem;
    		margin-left: 0.15rem;
    		transform:rotate(90deg);
			-ms-transform:rotate(90deg); 	/* IE 9 */
			-moz-transform:rotate(90deg); 	/* Firefox */
			-webkit-transform:rotate(90deg); /* Safari 和 Chrome */
			-o-transform:rotate(90deg); 
    	}
    	.main li b,.othermain li b{
    		font-weight: normal;
    	}
    	.main p span,.othermain p span{
    		float: right;
    	}
    	.main p span i,.othermain p span i{
    		transform:rotate(-90deg);
			-ms-transform:rotate(-90deg); 	/* IE 9 */
			-moz-transform:rotate(-90deg); 	/* Firefox */
			-webkit-transform:rotate(-90deg); /* Safari 和 Chrome */
			-o-transform:rotate(-90deg); 
    	}
    	button.paiban{
    		width: 1.8rem;
    		height: 0.6rem;
    		border-radius: 0.6rem;
    		color: white;
    		background: linear-gradient(to bottom,#FFCC3C,#F0B715)!important;
    		position: relative;
    		top: 0.2rem;
    		border: 0;
    		font-size: 0.26rem;
    	}
    	button.zhuanban,.main  button.zhuanrang,.main button.history{
    		width: 1.8rem;
    		height: 0.6rem;
    		border-radius: 0.6rem;
    		color: white;
    		background: linear-gradient(to bottom,#FF9C3D,#EF4C12);
    		position: relative;
    		top: 0.2rem;
    		border: 0;
    		font-size: 0.26rem;
    	}
    	.main button.zhuanrang,.main button.history{
    		margin-left: 0.2rem;
    	}
    	button.submit{
    		width: 5.6rem;
    		height: 0.6rem;
    		border-radius: 0.6rem;
    		color: white;
    		background: linear-gradient(to bottom,#FFCC3C,#F0B715);
    		position: relative;
    		top: 0.4rem;
    		border: 0;
    		font-size: 0.26rem;
    	}
    	.zhuanbanWrap{
    		padding: 0.25rem;
    		width: 6.5rem;
    		/*height: 6.17rem;*/
    		background-color: #fff;
    		border-radius: 0.3rem;
    		position: fixed;
    		top: 1.8rem;
    		left: 0.5rem;
    		z-index: 222;
    		line-height: 0.5rem;
    		padding-bottom: 1rem;
    		border: 1px solid #eee;
    	}
    	textarea{
    		width: 100%;
    		resize: none;
    		height: 2.5rem;
    		margin-top: 0.2rem;
    		text-indent: 2em;
    		line-height: 0.35rem;
    		border: 1px solid #aaa;
    	}
    	.tab_twoli{
    		/*padding: 0 0.6rem;*/
    	}
    	.tab_twoli .paiban,.tab_twoli .zhuanban{
    		top: 0;
    		right: 0;
    	}
    	.tab_twoli li{
    		float: left;
    		width: 33.33%;
    	}
    	.tab_twoli button{
    		width: 1.8rem;
    		height: 0.6rem;
    		border-radius: 0.6rem;
    		color: white;
    		background: linear-gradient(to bottom,#FF9C3D,#EF4C12);
    		position: relative;
    		/*right: 0.4rem;*/
    		border: 0;
    		font-size: 0.26rem;
    	}
    	.zhuanzhengFloat input{
    		height: 0.85rem;
    		width: 100%;
    		margin: 0.1rem 0;
    		border: 1px solid #aaa;
    		padding-left: 0.26rem;
    		box-sizing: border-box;
    	}
    </style>
</head>
<body class="up-page">
	<div class="zhuanbanFloat" style="display:none;">
		<div class="float" style="display: block;"></div>
		<div class="zhuanbanWrap">
			<p>申请人：<span class="t_name"></span></p>
			<p>申请转班对象：<span class="s_name"></span></p>
			<p>转班理由：
				<textarea></textarea>
			</p>
			
			<p style="text-align: center;"><button class="submit">提交</button></p>
		</div>
	</div>
	<div class="zhuanzhengFloat" style="display:none;">
		<div class="float" style="display: block;"></div>
		<div class="zhuanbanWrap">
			<label for="a"><b>收费金额：</b></label><br />
			<input type="tel" name="a" id="a" value="" /><br />
			<label for="b"><b>购买课时：</b></label><br />
			<input type="tel" name=b"" id="b" value="" /><br />
			<label for="c"><b>收据编号：</b></label><br />
			<input type="tel" name="c" id="c" value="" />
			<p style="text-align: center;"><button class="submit">提交</button></p>
		</div>
			
	</div>
	<div class="beizhuFloat" style="display:none;">
		<div class="float" style="display: block;"></div>
		<div class="zhuanbanWrap">
			<p><b>增加备注：</b>
				<textarea></textarea>
			</p>
			<p style="text-align: center;"><button class="submit">提交</button></p>
		</div>
	</div>
	<div class="up-page-wrapper" >
		<div class="header">
			<div class="search">
				<img src="../../img/bodyBg/search@3x.png"/>
				<input type="text" name="search" id="search" value="" placeholder="输入学员姓名"/>
			</div>
		</div>
		<div class="teacher">
			<div class="tab" style="margin-bottom: 0.15rem;">
				<ul>
					<li class="active" index="1"><span>学员</span></li>
					<li index="2"><span>非学员</span></li>
				</ul>
				<div class="clearfix"></div>
			</div>
		</div>
		<div class="main">
			<ul>
				
			</ul>
		</div>
		<div class="othermain" style="display: none;">
			<ul>
				
			</ul>
		</div>
	</div>
</body>
<script src="../../js/jquery-3.3.1.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/commonUI.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/utils.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/mobileSelect.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/datePicker.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
	var ui = window.CUMS.UI,studentId,_this,newewclassid=0;
//	ui.showToast( '板块正在开发！');
	//性别选择
	$('.search img').click(function(){
		
		if($('.tab li.active').attr('index')==1){
			yiqiandan($("#search").val());
		}else if($('.tab li.active').attr('index')==2){
			weiqiandan($("#search").val());
		}
	})
	$('#search').bind('keyup', function(event) {

	　　if (event.keyCode == "13") {
	
	　　　　//回车执行查询
			if($('.tab li.active').attr('index')==1){
				yiqiandan($("#search").val());
			}else if($('.tab li.active').attr('index')==2){
				weiqiandan($("#search").val());
			}
	
	　　}
	
	});
	$('.teacher .tab li').click(function(){
		$('.content').hide();
		$('b').show();
		$('.teacher .tab li.active').removeClass('active');
		$(this).addClass('active');
		//下面需要修改 扇形表的数据
		if($(this).text()=="学员"){
			$(".main").show();
			$(".othermain").hide();
			$("body").css("background-image","url(../../img/bodyBg/ditui@3x.jpg)")
		}else{
			$(".main").hide();
			$(".othermain").show();
			$("body").css("background-image","url(../../img/bodyBg/e588fb4a3829738be827a3d1c3fe63b.png)")
		}
	})
	var weekdayArr=[],teacherId=[],chooseId=0;
	getAjax(hostAjax+"/api/principal/v1/selectteacherlist",{//查看所有老师
		user_id:9
	},function(data){
		var str="",haseCommite="",imgUrl;
		if(data.Data!=""){
			for (var i=0;i<data.Data.list.length;i++) {
				weekdayArr.push(data.Data.list[i].nickname);
				teacherId.push(data.Data.list[i].id);
			}
			
		}
	})
	yiqiandan();
	weiqiandan();
	function yiqiandan(nameStr){getAjax(hostAjax+"/api/tch/v1/signedbilllist",{//已签单
			user_id:uid,
			student_name:nameStr
		},function(data){
			var str="",color="";
			if(data.Data!=""){
				for (var i=0;i<data.Data.list.length;i++) {
					if(data.Data.list[i].classhour<=8){
						color= 'style="color:red;margin:0 0.1rem;font-size:0.3rem"';
					}else{
						color="";
					}
					
					str+='<li id="'+data.Data.list[i].id+'"><div class="name1">'+data.Data.list[i].name+'</div><span><b >剩余<b '+color+' >'+data.Data.list[i].classhour+'</b>课时</b><i class="iconfont icon-you"></i></span>'+
					'<div class="content" style="display:none ;">'+
						
						'<p>生日：</p>'+
						'<p>性别：</p>'+
					'	<p>电话：</p>'+
					'	<p>学校：</p>'+
						'<p>班级：</p>'+
						'<p>报名课时：课时</p>'+
						'<p>报名时间：</p>'+
						
						'<p>已报名总课时：课时</p>'+
						'<p>已消耗课时：课时</p>'+
						'<p>剩余课时：课时</p>'+
						'<p style="position: relative;bottom: 0.6rem;"><span>收起<i class="iconfont icon-you"></i></span><div class="clearfix"></div></p>'+
						
					'</div></li>'
				}
				$(".main ul").html(str);
				$(".main li i").click(function(){
					var _this=this,xufeiStr="",studentId=$(_this).parents("li").attr('id');
			//		ui.showToast( '展开信息！');
					if($(this).parents('li').find('.content').css("display")=="block"){
						$(this).parents('li').find('.content').hide();
						$(this).parents('li').find('b').show();
						return false;
					}
					//展开显示详情
					getAjax(hostAjax+"/api/tch/v1/getstudentsinginfo",{
						user_id:$(_this).parents("li").attr('id')
					},function(data){
						var str="";
						if(data.Data!=""){
							if(data.Data.createdat==""){
								data.Data.createdat="无"
							}
							if(data.Data.yytime==""){
								data.Data.yytime="无"
							}
							if(data.Data.appointmentcordcontent==""){
								data.Data.appointmentcordcontent="无"
							}
							if(data.Data.yynums==""){
								data.Data.yynums="0"
							}
							try{
								for (var j=0;j<data.Data.renew_list.length;j++){
								xufeiStr+='<p>第'+(j+1)+'次续费课时：'+data.Data.renew_list[j].classhour+'课时</p>'+
						'<p>第'+(j+1)+'次续费时间：'+data.Data.renew_list[j].createdAt+'</p>';
							}
							}catch(e){
								//TODO handle the exception
							}
							var paibanStr="";
							if(data.Data.list.classname==""){
								data.Data.list.classname='未排班';
								paibanStr+='<button class="paiban">排班</button>';
							}else{
								if(data.Data.list.classname.indexOf("班")>0){
									
								}else{
									data.Data.list.classname=data.Data.list.classname+"班";
								}
								
								paibanStr+='<button class="zhuanban">转班</button>';
							}
							if(data.Data.list.syclasshour<=0){
								data.Data.list.syclasshour=0;
							}
//							gostr="goUrl('studyhistry.html?studentId=&children')";
							$(_this).parents("li").find('.content').html('<p>登录账号：'+data.Data.list.Accountnumber+'</p>'+'<p>生日：'+data.Data.list.birthday+'</p>'+
						'<p>性别：'+data.Data.list.sex+'</p>'+
						'<p>电话：<a href="tel:'+data.Data.list.phone+'">'+data.Data.list.phone+'</a></p>'+
						'<p>学校：'+data.Data.list.nowschool+'</p>'+
						'<p>班级：'+data.Data.list.classname+'</p>'+
						'<p>报名课时：'+data.Data.list.classhour+'课时</p>'+
						'<p>报名时间：'+data.Data.list.createdAt+'</p>'+
						xufeiStr+
						'<p>已报名总课时：'+data.Data.list.sumclasshour+'课时</p>'+
						'<p>已消耗课时：'+data.Data.list.consumeclasshour +'课时</p>'+
						'<p>剩余课时：'+data.Data.list.syclasshour+'课时</p>'+
						paibanStr+
						'<button class="zhuanrang">学员转让</button>'+
						'<button class="history" >课堂记录</button>'+
						'<p class="hidden" style="position: relative;bottom: 0rem;height: 0.5rem;"><span>收起<i class="iconfont icon-you"></i></span><div class="clearfix"></div></p>');
						//<button class="paiban">排班</button>
							$(".hidden span").click(function(){
								if($(this).parents('li').find('.content').css("display")=="block"){
									$(this).parents('li').find('.content').hide();
									$(this).parents('li').find('b').show();
									return false;
								}
							})
							$(".history").click(function(){
								location.href="../../studyhistry.html?studentId="+studentId+"&children";
							})
							newewclassid=data.Data.list.classid;
							$(".paiban").unbind();
							$(".zhuanban").unbind();
							$(".zhuanbanFloat .float").unbind();
							$(".zhuanbanFloat .submit").unbind();
							$(".paiban").click(function(){
								sessionStorage.removeItem("zhuanban");
								location.href="../paiban/tap1.html?id="+$(this).parents("li").attr('id');
							})
							
							$(".zhuanban").click(function(){
//								if($(this).text()=="已申请转班"){
//									return false;
//								}
								sessionStorage.setItem("zhuanban",newewclassid);
								location.href="../paiban/tap1.html?id="+$(this).parents("li").attr('id');
								return false;
								$('.zhuanbanFloat textarea').val("")
								$(".zhuanbanFloat").show();
								$(".t_name").text(localStorage.getItem("zhizhao_Name"));
								$(".s_name").text($(this).parents('li').find('.name1').text());
							})
							$(".zhuanbanFloat .float").click(function(){
								$(".zhuanbanFloat").hide();
							})
							//判断是否已经提交申请
							getAjax(hostAjax+"/api/tch/v1/applicationrecordfortransfer",{//
								user_id: parseInt(uid)
								  
							},function(data){
								if(data.Code==200){
									for (var a=0;a<data.Data.list.length;a++) {
										if(data.Data.list[a].Shiftstudentid==$(_this).parents("li").attr("id")){
//											ui.showToast( '成功！');
											$(_this).parents("li").find(".zhuanban").text("已申请转班");
										}
									}
								}else{
									
								}
							})
							if(Select!=undefined){
								$(".zhuanrang").click(function(){
									Select.show();
									$(".mobileSelect .content").show()
								})
								
							}else{
							Select=new MobileSelect({
							    trigger: '.zhuanrang', 
							    title: '选择老师',  
							    wheels: [
							                {data: weekdayArr}
							            ],
							    position:[2], //初始化定位 打开时默认选中的哪个 如果不填默认为0
							    transitionEnd:function(indexArr, data){
							        console.log(data);
							       
							    },
							    callback:function(indexArr, data){
							        console.log(data); console.log(indexArr);
							        chooseId=teacherId[indexArr];
							        //调取转让接口
							        getAjax(hostAjax+"/api/tch/v1/transferstudent",{//老师电话邀约之后的备注
			user_id: parseInt(uid),
			teacherid: parseInt(chooseId),
			studentid: studentId
			  
		},function(data){
//			if(stanby){
//				return false;
//			}
			if(data.Code==200){
				ui.showToast( '成功！');
			}else{
				ui.showToast( data.Msg);
			}
		})
							    }
							})};
							$(".zhuanbanFloat .submit").click(function(){
								if($('.zhuanbanFloat textarea').val()==""){
									ui.showToast( '请填写原因');
									return false;
								}
								postAjax(hostAjax+"/api/tch/v1/addshiftrecord",JSON.stringify({//提交转班申请
									  userid: uid,
									  shiftstudentid: studentId,
									  classid: newewclassid,
									  newewclassid: 0,
									  reason: $('.zhuanbanFloat textarea').val()
								}),function(data){
									if(data.Code==200){
										
										ui.showToast(data.Msg,2000);
									}else{
										ui.showToast(data.Msg,2000);
									}
								})
								$(".zhuanbanFloat").hide();
							})
						}
					})
					$('.content').hide();
					$('b').show();
					$(this).parents('li').find('.content').show();
					$(this).parents('li').find('b').hide();
				})
			}else{
				if($('#search').val()==""){
				}else{
					ui.showToast( '学员中没有您要搜索的学生');
				}
				
			}
		})}
	function weiqiandan(nameStr){
		getAjax(hostAjax+"/api/tch/v1/notsignedlist",{//未签单
				user_id:uid,
				student_name:nameStr
			},function(data){
				var str="";
				if(data.Data!=""){
					for (var i=0;i<data.Data.list.length;i++) {
						str+='<li id="'+data.Data.list[i].id+'"><div class="name1">'+data.Data.list[i].name+'</div><span><b>'+data.Data.list[i].phone+'</b><i class="iconfont icon-you"></i></span>'+
						'<div class="content" style="display:none ;">'+
							'<p>生日：</p>'+
							'<p>性别：</p>'+
							'<p>电话：</p>'+
							'<p>学校：</p>'+
							'<p>录入时间：</p>'+
							'<p>上次邀约时间：</p>'+
							'<p>预约次数：次</p>'+
							'<p>备注：</p>'+
							'<p style="position: relative;bottom: 0.6rem;"><span>收起<i class="iconfont icon-you"></i></span><div class="clearfix"></div></p>'+
							
						'</div></li>'
					}
					$(".othermain ul").html(str);
					$(".othermain li i").click(function(){
						 _this=this;
						studentId=$(_this).parents("li").attr('id');
						if($(this).parents('li').find('.content').css("display")=="block"){
							$(this).parents('li').find('.content').hide();
							$(this).parents('li').find('b').show();
							return false;
						}
						//展开显示详情
						getAjax(hostAjax+"/api/tch/v1/getstudentsinglist",{
							user_id:$(_this).parents("li").attr('id')
						},beizhuRefash,_this);
						$('.content').hide();
						$('b').show();
						$(this).parents('li').find('.content').show();
						$(this).parents('li').find('b').hide();
						
					})
				}else{
					if($('#search').val()==""){
						
					}else{
						ui.showToast( '非学员中没有您要搜索的学生');
					}
				}
			})
	}
	var Select=undefined;
		//点击备注之后在页面中显示--已经备注的信息
		function beizhuRefash(data,_this){
							var str="";
							if(data.Data!=""){
								if(data.Data.createdat==""){
									data.Data.createdat="无"
								}
								if(data.Data.yytime==""){
									data.Data.yytime="无"
								}
								if(data.Data.appointmentcordcontent==""){
									data.Data.appointmentcordcontent="无"
								}
								if(data.Data.yynums==""){
									data.Data.yynums="0"
								}
								var paibanStr="";
//								paibanStr+='<button class="zhuanban">转班</button>';
								if(data.Data.classname==""){
									data.Data.classname='未排班';
									paibanStr+='<button class="paiban">排班</button>';
								}else{
									if(data.Data.classname.indexOf("班")>0){
										
									}else{
										data.Data.classname=data.Data.classname+"班";
									}
									paibanStr+='<button class="zhuanban">转班</button>';
								}
								$(_this).parents("li").find('.content').html('<p>登录账号：'+data.Data.Accountnumber+'</p>'+'<p>生日：'+data.Data.birthday+'</p>'+
							'<p>性别：'+data.Data.sex+'</p>'+
							'<p>电话：<a href="tel:'+data.Data.phone+'">'+data.Data.phone+'</a></p>'+
							'<p>学校：'+data.Data.nowschool+'</p>'+
							'<p>班级：'+data.Data.classname+'</p>'+
							'<p>录入时间：'+data.Data.createdat+'</p>'+
							'<p>上次邀约时间：'+data.Data.yytime+'</p>'+
							'<p>预约次数：'+data.Data.yynums+'次</p>'+
							'<p>备注：'+data.Data.appointmentcordcontent+'</p>'+
							'<ul class="tab_twoli">'+
							'<li>'+paibanStr+'</li>'+
							'<li><button class="zhuanrang">学员转让</button></li>'+
				'<li><button class="zhuanzheng">转为学员</button></li>'+
				'<li><button class="beizhu">邀约备注</button></li>'+
				'<button class="history" >课堂记录</button>'+
				'<div class="clearfix"></div>'+
			'</ul>'+
							'<p class="hidden" style="position: relative;bottom: 0.2rem;"><span>收起<i class="iconfont icon-you"></i></span><div class="clearfix"></div></p>');
							$(".hidden").click(function(){
								if($(this).parents('li').find('.content').css("display")=="block"){
									$(this).parents('li').find('.content').hide();
									$(this).parents('li').find('b').show();
									return false;
								}
							})
							$(".history").click(function(){
								location.href="../../studyhistry.html?studentId="+studentId+"&children";
							})
							$(".zhuanzheng").unbind();
							$(".zhuanrang").unbind();
							$(".zhuanzhengFloat .float").unbind();
							$(".beizhu").unbind();
							$(".beizhuFloat .float").unbind();
							$(".zhuanzheng").click(function(){
								$('.zhuanzhengFloat textarea').val("")
								$(".zhuanzhengFloat").show();
							})
							
							if(Select!=undefined){
								$(".zhuanrang").click(function(){
									console.log(Select)
									Select.show();
									$(".mobileSelect .content").show()
								})
								
							}else{
							Select=new MobileSelect({
							    trigger: '.zhuanrang', 
							    title: '选择老师',  
							    wheels: [
							                {data: weekdayArr}
							            ],
							    position:[2], //初始化定位 打开时默认选中的哪个 如果不填默认为0
							    transitionEnd:function(indexArr, data){
							        console.log(data);
							       
							    },
							    callback:function(indexArr, data){
							        console.log(data); console.log(indexArr);
							        chooseId=teacherId[indexArr];
							        //调取转让接口
							        getAjax(hostAjax+"/api/tch/v1/transferstudent",{//老师电话邀约之后的备注
			user_id: parseInt(uid),
			teacherid: parseInt(chooseId),
			studentid: studentId
			  
		},function(data){
//			if(stanby){
//				return false;
//			}
			if(data.Code==200){
				ui.showToast( '成功！');
			}else{
				ui.showToast( data.Msg);
			}
		})
							    }
							})};
							$(".zhuanzhengFloat .float").click(function(){
								$(".zhuanzhengFloat").hide();
							})
							$(".beizhu").click(function(){
								$('.zhuanzhengFloat textarea').val("");
								$(".beizhuFloat").show();
							})
							$(".beizhuFloat .float").click(function(){
								$(".beizhuFloat").hide();
							})
							$(".zhuanzhengFloat .submit").click(function(){
								if($('#a').val()==""){
									ui.showToast( '请填写收费金额');
									return false;
								}
								if($('#b').val()==""){
									ui.showToast( '请填写购买课时');
									return false;
								}
								if($('#c').val()==""){
									ui.showToast( '请填写收据编号');
									return false;
								}
								postAjax(hostAjax+"/api/tch/v1/atranslator",JSON.stringify({//老师电话邀约之后的备注
									  userid: uid,
									  studentid: studentId,
									 	price: $('#a').val(),
									  classhour: $('#b').val(),
									  contractno: $('#c').val(),
									  remark: ""
								}),function(data){
									if(data.Code==200){
										ui.showToast( '成功！');
										setTimeout(function(){
											location.reload();
										})
									 	$('#a').val("");
									 	$('#b').val("");
									 	$('#c').val("");
									   	$(".zhuanzhengFloat").hide();
									   	
									}
								})
								$(".zhuanbanFloat").hide();
							})
							$(".paiban").unbind();
							$(".zhuanban").unbind();
							$(".zhuanbanFloat .float").unbind();
							$(".zhuanbanFloat .submit").unbind();
							$(".paiban").click(function(){
								sessionStorage.removeItem("zhuanban");
								location.href="../paiban/tap1.html?id="+$(this).parents("li").parents("li").attr('id');
							})
							$(".zhuanban").click(function(){
//								if($(this).text()=="已申请转班"){
//									return false;
//								}
								sessionStorage.setItem("zhuanban",newewclassid);
								location.href="../paiban/tap1.html?id="+$(this).parents("li").parents("li").attr('id');
								return false;
								$('.zhuanbanFloat textarea').val("")
								$(".zhuanbanFloat").show();
								$(".t_name").text(localStorage.getItem("zhizhao_Name"));
								$(".s_name").text($(this).parents('li').parents('li').find('.name1').text());
							})
							$(".zhuanbanFloat .float").click(function(){
								$(".zhuanbanFloat").hide();
							})
							newewclassid=data.Data.classid;
							$(".zhuanbanFloat .submit").click(function(){
								if($('.zhuanbanFloat textarea').val()==""){
									ui.showToast( '请填写原因');
									return false;
								}
								postAjax(hostAjax+"/api/tch/v1/addshiftrecord",JSON.stringify({//提交转班申请
									  userid: uid,
									  shiftstudentid: studentId,
									  classid: newewclassid,
									  newewclassid: 0,
									  reason: $('.zhuanbanFloat textarea').val()
								}),function(data){
									if(data.Code==200){
										ui.showToast(data.Msg,2000);
									}else{
										ui.showToast(data.Msg,2000);
									}
								})
								$(".zhuanbanFloat").hide();
							})
							$(".beizhuFloat .submit").unbind();
							$(".beizhuFloat .submit").click(function(){
								if($('.beizhuFloat textarea').val()==""){
									ui.showToast( '请填写备注信息');
									return false;
								}
								postAjax(hostAjax+"/api/tch/v1/addappointmentcord",JSON.stringify({//老师电话邀约之后的备注
									  userid: uid,
									  studentid: studentId,
									 content: $('.beizhuFloat textarea').val(),
									  type: 0,
									  remark: ""
								}),function(data){
									if(data.Code==200){
										ui.showToast( '成功！');
									 	$('.beizhuFloat textarea').val("");
									   	$(".beizhuFloat").hide();
									   	getAjax(hostAjax+"/api/tch/v1/getstudentsinglist",{
											user_id:$(_this).parents("li").attr('id')
										},beizhuRefash,_this);
										$(".beizhuFloat .submit").unbind();
									}
								})
								$(".zhuanbanFloat").hide();
							})
							//判断是否已经提交申请
							getAjax(hostAjax+"/api/tch/v1/applicationrecordfortransfer",{//
								user_id: parseInt(uid)
								  
							},function(data){
								if(data.Code==200){
									for (var a=0;a<data.Data.list.length;a++) {
										if(data.Data.list[a].Shiftstudentid==$(_this).parents("li").attr("id")){
//											ui.showToast( '成功！');
											$(_this).parents("li").find(".zhuanban").text("已申请转班");
										}
									}
								}else{
									
								}
							})
							}
						}
</script>
</html>