<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
   	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=0">
    <title>新增学员详情</title>
    <link rel="stylesheet" type="text/css" href="../../css/common.css"/>
    <link rel="stylesheet" type="text/css" href="../../iconfont/iconfont.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/commonUI.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/index.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/mobileSelect.css"/>
    <script src="../../js/resize.js" type="text/javascript" charset="utf-8"></script>
    <style type="text/css">
    	body{
    		background-image: url(../../img/bodyBg/newStudentbg@3x.jpg);
    		background-size: 100%;
    	}
    	.header,.main,.yes,.no{
    		font-size: 0.26rem;
    	}
    	.title{
    		width: 4.47rem;
    		height: 0.75rem;
    		line-height: 0.75rem;
    		background-image: url(../../img/bodyBg/newTitleBg.png);
    		background-size: 100%;
    		text-align: center;
    		color: white;
    		background-repeat: no-repeat;
    		margin: 0.5rem auto ;
    	}
    	.header ul,.yes ul,.no ul{
    		padding: 0.5rem;
    	}
    	.header input,.yes input,.no input,.header select,.yes select,.no select{
    		height: 0.6rem;
    		font-size: 0.26rem;
    		margin: 0.26rem 0;
    		padding-left: 0.16rem;
    		border: 1px solid #aaa;
    		box-sizing: border-box;
    	}
    	.main{
    		padding: 0.5rem;
    	}
    	.haseBaoming ul li{
    		float: left;
    		width: 50%;
    	}
    	.haseBaoming ul li input{
    		margin-right: 0.26rem;
    		margin-top: 0.26rem;
    		margin-left: 0;
    		font-size: 0.3rem;
    		width: 0.26rem!important;
    		height: 0.26rem!important;
    	}
    	.up-page-wrapper button{
    		width: 6.5rem;
    		display: block;
    		margin: 1.4rem auto 1rem auto;
    		height: 0.6rem;
    		line-height: 0.6rem;
    		background-color: #EFB511;
    		border-radius: 0.6rem;
    		border: 0;
    		box-shadow: 2px 5px 2px #aaa;
    		color: white;
    		font-size: 0.26rem;
    	}
    	.header li{
    		line-height: 0.6rem;
    	}
    </style>
</head>
<body class="up-page">
	<div class="up-page-wrapper" >
		<div class="header">
			<div class="title">凤凰机器人续费表</div>
			<ul class="aaaa">
				
				</ul>
				<ul style="padding-top: 0;padding-bottom: 0;">
					
				
				<li ><label for="xufeiTime">续费金额(元)：</label><br /><input style="width: 2.75rem;" type="tel" name="xufeiTime" id="xufeiTime" value="" /></li>
				<li class="changguike"></li>
				<p style="clear: both;"></p>
				<li class="addCourseType">
					
				</li>
				<div class="addIcon" style="text-align: center;"><i class="iconfont icon-plus-add" style="font-size: 0.5rem;color: #888; border: 1px solid #888;width: 0.6rem;height: 0.6rem;border-radius: 0.6rem;"></i></div>
				<li style="clear: both;"><label for="hetongNum">收据编号：</label><br /><input style="width: 100%;" type="text" name="hetongNum" id="hetongNum" value="" /></li>
				<li><label for="remark">备注：</label><br /><input style="width: 100%;" type="text" name="remark" id="remark" value="" /></li>
				
			</ul>
			<ul class="bbbb" style="padding-top: 0;">
				
			</ul>
		</div>
		<button>提交</button>
	</div>
</body>
<script src="../../js/jquery-3.3.1.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/commonUI.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/utils.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/mobileSelect.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/datePicker.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
	var ui = window.CUMS.UI;var ajaxData,ifClick=true;
//	ui.showToast( '板块正在开发！');
	getAjax(hostAjax+"/api/course/v1/getsubjecttype",{
		
	},function(data){
		var str="";
		for (var s=0;s<data.Data.length;s++) {
			if(data.Data[s].id!=2)
			str+='<option value="'+data.Data[s].id+'">'+data.Data[s].typename+'</option>';
		}
		addStr='<li style="float: left;margin-right: 0.9rem;"><label for="money">赠送课时类型：</label><br /><select class="courseType" name=""style="width: 2.75rem;"><option value="0">请选择</option>'+
					str+
				'</select></li>'+
				'<li><label for="">赠送课时：</label><br /><input style="width: 2.75rem;" type="tel" name="totleTime2" class="totleTime" value="" /></li>';
				$(".changguike").html('<li style="float: left;"><header >报名课程类型：</header>'+
				'<select class="courseType" name=""style="width: 2.75rem;"><option value="0">请选择</option><option value="2">常规课</option>'+
					str+
				'</select></li>'+'<li style="float: right;"><label for="" >报名课时：</label><br /><input style="width: 2.75rem;" type="tel" name="totleTime2" class="totleTime" value="" /></li>');
		$(".addCourseType").html(addStr);
		
		$(".addIcon i").click(function(){
			$(".addCourseType").append(addStr);
		})
	})
	$("button").click(function(){
		var classhourtype="";
//		if($("#money").val()!=""&&$(".totleTime").eq(0).val()==""){
//			ui.showToast( "请输入购买课时",1500);
//			return false;
//		}
//		if($("#money").val()==""&&$(".totleTime").eq(0).val()==""){
//			classhourtype="4|0,";
//		}
		ui.showAlert('是否确认为'+$(".name p").text()+"学员续费", function () {
				var stop=false;
				if($(".courseType").eq(0).val()==0){
						ui.showToast( "报名课时不能为0",2000);
						stop=true;
						return false;
					}
				$(".totleTime").each(function(i){//courseType
					if($(this).val()!=""&&$(".courseType").eq(i).val()==0){
						ui.showToast( "请选择课时对应的课时类型",2000);
						stop=true;
						return false;
					}
					
					if($(this).val()!=""&&$(".courseType").eq(i).val()!=0){
						classhourtype+=$(".courseType").eq(i).val()+"|"+$(".totleTime").eq(i).val()+",";
					}else if($(".courseType").eq(i).val()==4){
				classhourtype+=$(".courseType").eq(i).val()+"|"+0+",";
			}
				})
				if(stop){
					return false;
				}
				classhourtype=classhourtype.substring(0,classhourtype.length-1);
				ajaxData=JSON.stringify({//续费接口
				  "userid": uid,
				  "studenid": location.href.split("id=")[1].split("&")[0],
				  "price": $("#xufeiTime").val(),
				  "classhourtype":classhourtype,
				  "contractno": $("#hetongNum").val(),
				  "remark":  $("#remark").val(),
				})
			
			if(ifClick){
				ifClick=false;
				postAjax(hostAjax+"/api/tch/v1/addrenew",ajaxData,function(data){
					if(data.Data!=""){
						
						ui.showToast( '提交成功',500);
						setTimeout(function(){
							sessionStorage.setItem("ifReload",1);
							history.back();
						},1000)
					}else{
						ui.showToast( data.Msg);
						ifClick=true;
					}
				})
			}
	            },null,"确认","取消","提示");
			
				
	})
	getAjax(hostAjax+"/api/stu/v1/studentinfo",{//学生信息--昵称、名字、电话、头像
		user_id:location.href.split("id=")[1].split("&")[0]
	},function(data){
		if(data.Data!=""){
			console.log(data);
			$(".name p").text(data.Data[0].name);
			if(data.Data[0].imgurl!=""){
				$(".name img").attr("src",data.Data[0].imgurl);
			}
			$(".class").text(data.Data[0].nowgrade);
			$(".birthday").text(data.Data[0].birthday);
			$(".tel").text(data.Data[0].phone);
			if(data.Data[0].nowgrade==""){
				data.Data[0].nowgrade="未填写";
			}
			$('.aaaa').html('<li class="name" style="float: left;margin-right: 0.9rem;width: 50%;"><label for="name">学员姓名：</label><p>'+data.Data[0].name+'</p></li>'+
				'<li><label for="six">学员性别：</label><br />'+data.Data[0].sex+'</li>'+
				'<li><label for="birthday">学员生日：</label><br />'+data.Data[0].birthday+'</li>'+
				'<li><label for="tel">家长联系方式：</label><br />'+data.Data[0].phone+'</li>'+
				'<li><label for="tel">班级：</label><br />'+data.Data[0].nowgrade+'</li>')
			getAjax(hostAjax+"/api/tch/v1/getstudentsinginfo",{
						user_id:location.href.split("id=")[1].split("&")[0]
					},function(data){
						var str="";
						if(data.Data.list[0].syclasshour<=0){
							data.Data.list[0].syclasshour=0;
						}
						if(data.Data!=""){
							$('.bbbb').html('<li style="float: left;width: 33.33%;"><label for="name">已报名总课时：</label><br />'+data.Data.list[0].sumclasshour+'</li>'+
				'<li style="float: left;width: 33.33%;"><label for="name">剩余课时：</label><br /><span>'+parseFloat(data.Data.list[0].syclasshour<=0?0:data.Data.list[0].syclasshour)+'<span></li>'+
				'<li style="float: left;width: 33.33%;"><label for="name">已消耗课时：</label><br />'+data.Data.list[0].consumeclasshour+'</li>');
							if(data.Data.list[0].syclasshour<=8){
								$('.bbbb li').eq(1).find("span").css("color","red");
								$('.bbbb li').eq(1).find("span").css("font-size","0.3rem");
							}
						}
					})
		}
	})
</script>
</html>